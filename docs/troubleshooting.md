# PowerPack Troubleshooting

## Introduction
This document provides guidance on how to diagnose and resolve common issues encountered when running PowerPacks through **CapaInstaller**.
It is intended for developers and IT operations personnel responsible for maintaining or deploying PowerPacks.

Most PowerPack issues can be identified through **log analysis** or by verifying environment requirements such as .NET runtime and service status.
This document also helps the custom ChatGPT assistant provide context-aware troubleshooting guidance.

---

## How to Read PowerPack Logs
PowerPack execution logs are stored locally on the client endpoint and uploaded to the CapaInstaller database after completion.
Logs are located here:

```
C:\Program Files\CapaInstaller\Client\Logs
```

If the main log appears outdated, open the corresponding PowerPack subfolder, for example:

```
C:\Program Files\CapaInstaller\Client\Logs\SDK - Delete Users Older Than X Days\
```

### Log File Overview

| File | Description |
|------|--------------|
| **Install.log / Uninstall.log** | Script-level logs generated by the PowerPack itself. They contain the output and status from the PowerPack’s Install or Uninstall process. |
| **CapaOne.ScriptingLibrary.log** | Used to review *PowerPack Global Variables* and internal helper function output. Helpful for debugging logic or variable state. |
| **PowerPackClient.log** | Contains client-side execution details, including PowerShell command output. Useful for identifying why a script failed to execute or returned unexpected output. |
| **PowerPackServer.log** | Captures communication between client and server components. Use this log when the PowerPack does not appear to start or report results back to CapaInstaller. |

> **Tip:** If multiple runs exist, review the `History` subfolder within the PowerPack log directory to inspect previous executions.

---

## Common Troubleshooting Steps

### 1. PowerPack Does Not Start
If a PowerPack fails immediately or never starts execution:
1. Check `PowerPackClient.log` and `PowerPackServer.log` for initialisation or runtime errors.
2. Verify that the **CapaInstaller Agent** and **BaseAgent** services are running.
3. Confirm that **.NET Desktop Runtime 8.0** is installed.
   - It is required to run PowerPacks.
   - The runtime can be installed using the **.NET Desktop Runtime CapaPack** available in CapaInstaller.
4. Ensure that the PowerPack package (`.kit`) is not corrupted and matches the version assigned to the endpoint.
5. Reboot the client if recent CapaInstaller agent updates were applied.

---

### 2. PowerPack Fails During Execution
If the PowerPack starts but fails mid-execution:
1. Review **Install.log** (or **Uninstall.log**) for PowerShell error messages or failed function calls.
2. Check **CapaOne.ScriptingLibrary.log** to inspect variable values (for example `$global:gsSystemDirx86`, `$global:gsCommonFilesDir`, etc.).
3. Verify that any required files in the `Kit` folder are present and accessible.
4. Confirm network access to required servers, shares, or APIs.
5. If the error refers to access denied or missing privileges, remember that PowerPacks run under **System context** unless specifically switched to **User context** using helper functions.

---

### 3. Missing or Empty Logs
If no logs are created or the log window in CapaInstaller shows only placeholders:
1. Check the **PowerPackClient.log** to see if the PowerShell script was invoked at all.
2. Verify permissions on `C:\Program Files\CapaInstaller\Client\Logs`.
3. Ensure the disk is not full and that antivirus exclusions include the CapaInstaller folders.
4. Restart the CapaInstaller Agent service and rerun the job.

---

### 4. Dependency or Environment Errors
Typical dependency issues include missing runtime components or incompatible frameworks.
For example, the message:

> `.Net Desktop Runtime is not installed, and is needed (version 8.0.0) in order to install PowerPacks.`

**Resolution:**
- Deploy the **Microsoft .NET Desktop Runtime 8.0 CapaPack** from the CapaInstaller console.
- After installation, re-run the failed PowerPack.
- If the error persists, verify that the correct architecture (x64) is installed.

---

### 5. Script Output Not as Expected
When PowerPack logic executes but produces unexpected results:
1. Review **PowerPackClient.log** for the raw PowerShell output.
2. Compare expected variable values using **CapaOne.ScriptingLibrary.log**.
3. Re-test the script section manually in PowerShell using the same context (System or User).
4. If using registry or file operations, confirm the path and permissions in System context.

---

## Typical Quick Fixes
- **Restart CapaInstaller Agent and BaseAgent** services after any update or failure.
- **Deploy or reinstall .NET Desktop Runtime 8.0** using the CapaPacks.
- **Re-export and redeploy** the PowerPack if the `.kit` appears incomplete or mismatched.
- **Check all logs** before assuming script failure — the root cause often appears in *PowerPackClient.log*.
- **Validate Kit content** before deployment to avoid missing dependency files.

---

## GPT Usage Context
This file is part of the knowledge base used by the custom ChatGPT assistant.
The GPT can use it to:
- Explain how to interpret PowerPack logs
- Suggest troubleshooting steps for common runtime errors
- Recommend installation or configuration fixes (e.g., missing .NET runtime or agent issues)
- Provide safe, context-specific advice to end-users encountering PowerPack problems

